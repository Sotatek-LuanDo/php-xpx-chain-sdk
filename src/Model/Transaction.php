<?php
/**
 * NIS2 API
 *
 * This document defines all the nis2 api routes and behaviour
 *
 * OpenAPI spec version: 1.0.0
 * Contact: greg@evias.be
 *
 * NOTE: This class is auto generated by the swagger code generator program.
 * https://github.com/swagger-api/swagger-codegen
 * Do not edit the class manually.
 * 
 */

namespace Proximax\Model;

use Proximax\Model\TransactionType;
use Proximax\Model\Transaction\Transfer;
use Proximax\Model\Transaction\Signature;
use Proximax\Model\Account;
use Proximax\Model\Message;
use Proximax\Utils\Hex;
use Proximax\Utils\Utils;
/**
 * Transaction class Doc Comment
 *
 * @category class
 * @package  Proximax
 * @author   Swagger Codegen team
 * @link     https://github.com/swagger-api/swagger-codegen
 */
class Transaction{

    const HEADER_SIZE = 122;

    private $abstractTransaction; //AbstractTransaction

    public function createTransactionHash(array $payloadBytes,array $generationHashBytes){
        $hex = new \Proximax\Utils\Hex;
        $p1 = array_slice($payloadBytes,4,32);
        $p2 = array_slice($payloadBytes,68,32);
        $p3 = array_slice($generationHashBytes,0,32);
        $p4 = array_slice($payloadBytes,100,count($payloadBytes)-100);

        $sb = array_merge($p1,$p2,$p3,$p4);

        $sha3Hasher = new \Proximax\Core\Sha3Hasher;

        $r = $sha3Hasher->hash("sha3-256",implode(array_map("chr", $sb)));

        return $r;
    }

    public function getAbstractTransaction(){
        return $this->abstractTransaction;
    }

    public function setAbstractTransaction($abstractTransaction){
        return $this->abstractTransaction = $abstractTransaction;
    }

    public function ToAggregate($signer){
        $this->abstractTransaction->setSigner($signer);
    }

    public function toAggregateTransactionBytes() {
        $hex = new Hex;
        $signerBytes = $hex->DecodeString($this->abstractTransaction->getSigner()->getPublicKey()); 

        $bytes = $this->generateBytes();
        $resultBytes = array();

        $utils = new Utils;
        // we will be removing header (122) and adding size (4), signer (32), version (4), trans type(2)
        $size = $utils->intToArray(count($bytes) - 122 + 4 + 32 + 4 + 2);
        $p1 = $utils->ReverseByteArray($size);

        $p2 = array_slice($signerBytes,0,32); // Copy signer
        $p3 = array_slice($bytes,100,6);// Copy type and version
        $p4 = array_slice($bytes,122, count($bytes) - 122);// Copy following data

        $resultBytes = array_merge($p1,$p2,$p3,$p4);
        return $resultBytes;
    }
}
